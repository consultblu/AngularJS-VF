/**
 * easyXDM
 * http://easyxdm.net/
 * Copyright(c) 2009-2011, Ã˜yvind Sean Kinsey, oyvind@kinsey.no.
 *
 * Permission is hereby granted, free of charge, to any person obtaining a copy
 * of this software and associated documentation files (the "Software"), to deal
 * in the Software without restriction, including without limitation the rights
 * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
 * copies of the Software, and to permit persons to whom the Software is
 * furnished to do so, subject to the following conditions:
 *
 * The above copyright notice and this permission notice shall be included in
 * all copies or substantial portions of the Software.
 *
 * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
 * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
 * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
 * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
 * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN
 * THE SOFTWARE.
 */
!function(n,e,t,o,r,a){function i(n,e){var t=typeof n[e];return"function"==t||!("object"!=t||!n[e])||"unknown"==t}function c(n,e){return!("object"!=typeof n[e]||!n[e])}function s(n){return"[object Array]"===Object.prototype.toString.call(n)}function l(){try{var n=new ActiveXObject("ShockwaveFlash.ShockwaveFlash");return J=Array.prototype.slice.call(n.GetVariable("$version").match(/(\d+),(\d+),(\d+),(\d+)/),1),A=parseInt(J[0],10)>9&&parseInt(J[1],10)>0,n=null,!0}catch(e){return!1}}function u(){if(!X){X=!0;for(var n=0;n<z.length;n++)z[n]();z.length=0}}function f(n,e){return X?void n.call(e):void z.push(function(){n.call(e)})}function p(){var n=parent;if(""!==H)for(var e=0,t=H.split(".");e<t.length;e++)n=n[t[e]];return n.easyXDM}function d(e){return n.easyXDM=P,H=e,H&&(j="easyXDM_"+H.replace(".","_")+"_"),D}function h(n){return n.match(E)[3]}function m(n){return n.match(E)[4]||""}function g(n){var e=n.toLowerCase().match(E),t=e[2],o=e[3],r=e[4]||"";return("http:"==t&&":80"==r||"https:"==t&&":443"==r)&&(r=""),t+"//"+o+r}function v(n){if(n=n.replace(C,"$1/"),!n.match(/^(http||https):\/\//)){var e="/"===n.substring(0,1)?"":t.pathname;"/"!==e.substring(e.length-1)&&(e=e.substring(0,e.lastIndexOf("/")+1)),n=t.protocol+"//"+t.host+e+n}for(;N.test(n);)n=n.replace(N,"");return n}function y(n,e){var t="",o=n.indexOf("#");-1!==o&&(t=n.substring(o),n=n.substring(0,o));var r=[];for(var i in e)e.hasOwnProperty(i)&&r.push(i+"="+a(e[i]));return n+(L?"#":-1==n.indexOf("?")?"?":"&")+r.join("&")+t}function w(n){return"undefined"==typeof n}function b(n,e,t){var o;for(var r in e)e.hasOwnProperty(r)&&(r in n?(o=e[r],"object"==typeof o?b(n[r],o,t):t||(n[r]=e[r])):n[r]=e[r]);return n}function k(){var n=e.body.appendChild(e.createElement("form")),t=n.appendChild(e.createElement("input"));t.name=j+"TEST"+T,B=t!==n.elements[t.name],e.body.removeChild(n)}function _(n){w(B)&&k();var t;B?t=e.createElement('<iframe name="'+n.props.name+'"/>'):(t=e.createElement("IFRAME"),t.name=n.props.name),t.id=t.name=n.props.name,delete n.props.name,n.onLoad&&I(t,"load",n.onLoad),"string"==typeof n.container&&(n.container=e.getElementById(n.container)),n.container||(b(t.style,{position:"absolute",top:"-2000px"}),n.container=e.body);var o=n.props.src;return delete n.props.src,b(t,n.props),t.border=t.frameBorder=0,t.allowTransparency=!0,n.container.appendChild(t),t.src=o,n.props.src=o,t}function x(n,e){"string"==typeof n&&(n=[n]);for(var t,o=n.length;o--;)if(t=n[o],t=new RegExp("^"==t.substr(0,1)?t:"^"+t.replace(/(\*)/g,".$1").replace(/\?/g,".")+"$"),t.test(e))return!0;return!1}function O(o){var r=o.protocol,a;if(o.isHost=o.isHost||w(Q.xdm_p),L=o.hash||!1,o.props||(o.props={}),o.isHost)o.remote=v(o.remote),o.channel=o.channel||"default"+T++,o.secret=Math.random().toString(16).substring(2),w(r)&&(g(t.href)==g(o.remote)?r="4":i(n,"postMessage")||i(e,"postMessage")?r="1":o.swf&&i(n,"ActiveXObject")&&l()?r="6":"Gecko"===navigator.product&&"frameElement"in n&&-1==navigator.userAgent.indexOf("WebKit")?r="5":o.remoteHelper?(o.remoteHelper=v(o.remoteHelper),r="2"):r="0");else if(o.channel=Q.xdm_c,o.secret=Q.xdm_s,o.remote=Q.xdm_e,r=Q.xdm_p,o.acl&&!x(o.acl,o.remote))throw new Error("Access denied for "+o.remote);switch(o.protocol=r,r){case"0":if(b(o,{interval:100,delay:2e3,useResize:!0,useParent:!1,usePolling:!1},!0),o.isHost){if(!o.local){for(var c=t.protocol+"//"+t.host,s=e.body.getElementsByTagName("img"),u,f=s.length;f--;)if(u=s[f],u.src.substring(0,c.length)===c){o.local=u.src;break}o.local||(o.local=n)}var p={xdm_c:o.channel,xdm_p:0};o.local===n?(o.usePolling=!0,o.useParent=!0,o.local=t.protocol+"//"+t.host+t.pathname+t.search,p.xdm_e=o.local,p.xdm_pa=1):p.xdm_e=v(o.local),o.container&&(o.useResize=!1,p.xdm_po=1),o.remote=y(o.remote,p)}else b(o,{channel:Q.xdm_c,remote:Q.xdm_e,useParent:!w(Q.xdm_pa),usePolling:!w(Q.xdm_po),useResize:o.useParent?!1:o.useResize});a=[new D.stack.HashTransport(o),new D.stack.ReliableBehavior({}),new D.stack.QueueBehavior({encode:!0,maxLength:4e3-o.remote.length}),new D.stack.VerifyBehavior({initiate:o.isHost})];break;case"1":a=[new D.stack.PostMessageTransport(o)];break;case"2":a=[new D.stack.NameTransport(o),new D.stack.QueueBehavior,new D.stack.VerifyBehavior({initiate:o.isHost})];break;case"3":a=[new D.stack.NixTransport(o)];break;case"4":a=[new D.stack.SameOriginTransport(o)];break;case"5":a=[new D.stack.FrameElementTransport(o)];break;case"6":J||l(),a=[new D.stack.FlashTransport(o)]}return a.push(new D.stack.QueueBehavior({lazy:o.lazy,remove:!0})),a}function M(n){for(var e,t={incoming:function(n,e){this.up.incoming(n,e)},outgoing:function(n,e){this.down.outgoing(n,e)},callback:function(n){this.up.callback(n)},init:function(){this.down.init()},destroy:function(){this.down.destroy()}},o=0,r=n.length;r>o;o++)e=n[o],b(e,t,!0),0!==o&&(e.down=n[o-1]),o!==r-1&&(e.up=n[o+1]);return e}function S(n){n.up.down=n.down,n.down.up=n.up,n.up=n.down=null}var R=this,T=Math.floor(1e4*Math.random()),F=Function.prototype,E=/^((http.?:)\/\/([^:\/\s]+)(:\d+)*)/,N=/[\-\w]+\/\.\.\//,C=/([^:])\/\//g,H="",D={},P=n.easyXDM,j="easyXDM_",B,L=!1,J,A,I,W;if(i(n,"addEventListener"))I=function(n,e,t){n.addEventListener(e,t,!1)},W=function(n,e,t){n.removeEventListener(e,t,!1)};else{if(!i(n,"attachEvent"))throw new Error("Browser not supported");I=function(n,e,t){n.attachEvent("on"+e,t)},W=function(n,e,t){n.detachEvent("on"+e,t)}}var X=!1,z=[],q;if("readyState"in e?(q=e.readyState,X="complete"==q||~navigator.userAgent.indexOf("AppleWebKit/")&&("loaded"==q||"interactive"==q)):X=!!e.body,!X){if(i(n,"addEventListener"))I(e,"DOMContentLoaded",u);else if(I(e,"readystatechange",function(){"complete"==e.readyState&&u()}),e.documentElement.doScroll&&n===top){var V=function(){if(!X){try{e.documentElement.doScroll("left")}catch(n){return void o(V,1)}u()}};V()}I(n,"load",u)}var Q=function(n){n=n.substring(1).split("&");for(var e={},t,o=n.length;o--;)t=n[o].split("="),e[t[0]]=r(t[1]);return e}(/xdm_e=/.test(t.search)?t.search:t.hash),U=function(){var n={},e={a:[1,2,3]},t='{"a":[1,2,3]}';return"undefined"!=typeof JSON&&"function"==typeof JSON.stringify&&JSON.stringify(e).replace(/\s/g,"")===t?JSON:(Object.toJSON&&Object.toJSON(e).replace(/\s/g,"")===t&&(n.stringify=Object.toJSON),"function"==typeof String.prototype.evalJSON&&(e=t.evalJSON(),e.a&&3===e.a.length&&3===e.a[2]&&(n.parse=function(n){return n.evalJSON()})),n.stringify&&n.parse?(U=function(){return n},n):null)};b(D,{version:"2.4.15.118",query:Q,stack:{},apply:b,getJSONObject:U,whenReady:f,noConflict:d}),D.DomHelper={on:I,un:W,requiresJSON:function(t){c(n,"JSON")||e.write('<script type="text/javascript" src="'+t+'"></script>')}},function(){var n={};D.Fn={set:function(e,t){n[e]=t},get:function(e,t){var o=n[e];return t&&delete n[e],o}}}(),D.Socket=function(n){var e=M(O(n).concat([{incoming:function(e,t){n.onMessage(e,t)},callback:function(e){n.onReady&&n.onReady(e)}}])),t=g(n.remote);this.origin=g(n.remote),this.destroy=function(){e.destroy()},this.postMessage=function(n){e.outgoing(n,t)},e.init()},D.Rpc=function(n,e){if(e.local)for(var t in e.local)if(e.local.hasOwnProperty(t)){var o=e.local[t];"function"==typeof o&&(e.local[t]={method:o})}var r=M(O(n).concat([new D.stack.RpcBehavior(this,e),{callback:function(e){n.onReady&&n.onReady(e)}}]));this.origin=g(n.remote),this.destroy=function(){r.destroy()},r.init()},D.stack.SameOriginTransport=function(n){var e,r,a,i;return e={outgoing:function(n,e,t){a(n),t&&t()},destroy:function(){r&&(r.parentNode.removeChild(r),r=null)},onDOMReady:function(){i=g(n.remote),n.isHost?(b(n.props,{src:y(n.remote,{xdm_e:t.protocol+"//"+t.host+t.pathname,xdm_c:n.channel,xdm_p:4}),name:j+n.channel+"_provider"}),r=_(n),D.Fn.set(n.channel,function(n){return a=n,o(function(){e.up.callback(!0)},0),function(n){e.up.incoming(n,i)}})):(a=p().Fn.get(n.channel,!0)(function(n){e.up.incoming(n,i)}),o(function(){e.up.callback(!0)},0))},init:function(){f(e.onDOMReady,e)}}},D.stack.FlashTransport=function(n){function r(n,e){o(function(){i.up.incoming(n,l)},0)}function a(t){var o=n.swf+"?host="+n.isHost,r="easyXDM_swf_"+Math.floor(1e4*Math.random());D.Fn.set("flash_loaded"+t.replace(/[\-.]/g,"_"),function(){D.stack.FlashTransport[t].swf=u=p.firstChild;for(var n=D.stack.FlashTransport[t].queue,e=0;e<n.length;e++)n[e]();n.length=0}),n.swfContainer?p="string"==typeof n.swfContainer?e.getElementById(n.swfContainer):n.swfContainer:(p=e.createElement("div"),b(p.style,A&&n.swfNoThrottle?{height:"20px",width:"20px",position:"fixed",right:0,top:0}:{height:"1px",width:"1px",position:"absolute",overflow:"hidden",right:0,top:0}),e.body.appendChild(p));var a="callback=flash_loaded"+t.replace(/[\-.]/g,"_")+"&proto="+R.location.protocol+"&domain="+h(R.location.href)+"&port="+m(R.location.href)+"&ns="+H;p.innerHTML="<object height='20' width='20' type='application/x-shockwave-flash' id='"+r+"' data='"+o+"'><param name='allowScriptAccess' value='always'></param><param name='wmode' value='transparent'><param name='movie' value='"+o+"'></param><param name='flashvars' value='"+a+"'></param><embed type='application/x-shockwave-flash' FlashVars='"+a+"' allowScriptAccess='always' wmode='transparent' src='"+o+"' height='1' width='1'></embed></object>"}var i,c,s,l,u,p;return i={outgoing:function(e,t,o){u.postMessage(n.channel,e.toString()),o&&o()},destroy:function(){try{u.destroyChannel(n.channel)}catch(e){}u=null,c&&(c.parentNode.removeChild(c),c=null)},onDOMReady:function(){l=n.remote,D.Fn.set("flash_"+n.channel+"_init",function(){o(function(){i.up.callback(!0)})}),D.Fn.set("flash_"+n.channel+"_onMessage",r),n.swf=v(n.swf);var e=h(n.swf),s=function(){D.stack.FlashTransport[e].init=!0,u=D.stack.FlashTransport[e].swf,u.createChannel(n.channel,n.secret,g(n.remote),n.isHost),n.isHost&&(A&&n.swfNoThrottle&&b(n.props,{position:"fixed",right:0,top:0,height:"20px",width:"20px"}),b(n.props,{src:y(n.remote,{xdm_e:g(t.href),xdm_c:n.channel,xdm_p:6,xdm_s:n.secret}),name:j+n.channel+"_provider"}),c=_(n))};D.stack.FlashTransport[e]&&D.stack.FlashTransport[e].init?s():D.stack.FlashTransport[e]?D.stack.FlashTransport[e].queue.push(s):(D.stack.FlashTransport[e]={queue:[s]},a(e))},init:function(){f(i.onDOMReady,i)}}},D.stack.PostMessageTransport=function(e){function r(n){if(n.origin)return g(n.origin);if(n.uri)return g(n.uri);if(n.domain)return t.protocol+"//"+n.domain;throw"Unable to retrieve the origin of the event"}function a(n){var t=r(n);t==l&&n.data.substring(0,e.channel.length+1)==e.channel+" "&&i.up.incoming(n.data.substring(e.channel.length+1),t)}var i,c,s,l;return i={outgoing:function(n,t,o){s.postMessage(e.channel+" "+n,t||l),o&&o()},destroy:function(){W(n,"message",a),c&&(s=null,c.parentNode.removeChild(c),c=null)},onDOMReady:function(){if(l=g(e.remote),e.isHost){var r=function(t){t.data==e.channel+"-ready"&&(s="postMessage"in c.contentWindow?c.contentWindow:c.contentWindow.document,W(n,"message",r),I(n,"message",a),o(function(){i.up.callback(!0)},0))};I(n,"message",r),b(e.props,{src:y(e.remote,{xdm_e:g(t.href),xdm_c:e.channel,xdm_p:1}),name:j+e.channel+"_provider"}),c=_(e)}else I(n,"message",a),s="postMessage"in n.parent?n.parent:n.parent.document,s.postMessage(e.channel+"-ready",l),o(function(){i.up.callback(!0)},0)},init:function(){f(i.onDOMReady,i)}}},D.stack.FrameElementTransport=function(r){var a,i,c,s;return a={outgoing:function(n,e,t){c.call(this,n),t&&t()},destroy:function(){i&&(i.parentNode.removeChild(i),i=null)},onDOMReady:function(){s=g(r.remote),r.isHost?(b(r.props,{src:y(r.remote,{xdm_e:g(t.href),xdm_c:r.channel,xdm_p:5}),name:j+r.channel+"_provider"}),i=_(r),i.fn=function(n){return delete i.fn,c=n,o(function(){a.up.callback(!0)},0),function(n){a.up.incoming(n,s)}}):(e.referrer&&g(e.referrer)!=Q.xdm_e&&(n.top.location=Q.xdm_e),c=n.frameElement.fn(function(n){a.up.incoming(n,s)}),a.up.callback(!0))},init:function(){f(a.onDOMReady,a)}}},D.stack.NameTransport=function(n){function e(e){var t=n.remoteHelper+(c?"#_3":"#_2")+n.channel;s.contentWindow.sendMessage(e,t)}function t(){c?2!==++u&&c||i.up.callback(!0):(e("ready"),i.up.callback(!0))}function r(n){i.up.incoming(n,d)}function a(){p&&o(function(){p(!0)},0)}var i,c,s,l,u,p,d,h;return i={outgoing:function(n,t,o){p=o,e(n)},destroy:function(){s.parentNode.removeChild(s),s=null,c&&(l.parentNode.removeChild(l),l=null)},onDOMReady:function(){c=n.isHost,u=0,d=g(n.remote),n.local=v(n.local),c?(D.Fn.set(n.channel,function(e){c&&"ready"===e&&(D.Fn.set(n.channel,r),t())}),h=y(n.remote,{xdm_e:n.local,xdm_c:n.channel,xdm_p:2}),b(n.props,{src:h+"#"+n.channel,name:j+n.channel+"_provider"}),l=_(n)):(n.remoteHelper=n.remote,D.Fn.set(n.channel,r)),s=_({props:{src:n.local+"#_4"+n.channel},onLoad:function e(){var r=s||this;W(r,"load",e),D.Fn.set(n.channel+"_load",a),function i(){"function"==typeof r.contentWindow.sendMessage?t():o(i,50)}()}})},init:function(){f(i.onDOMReady,i)}}},D.stack.HashTransport=function(e){function t(n){if(v){var t=e.remote+"#"+h++ +"_"+n;(l||!y?v.contentWindow:v).location=t}}function r(n){d=n,c.up.incoming(d.substring(d.indexOf("_")+1),w)}function a(){if(m){var n=m.location.href,e="",t=n.indexOf("#");-1!=t&&(e=n.substring(t)),e&&e!=d&&r(e)}}function i(){u=setInterval(a,p)}var c,s=this,l,u,p,d,h,m,v,y,w;return c={outgoing:function(n,e){t(n)},destroy:function(){n.clearInterval(u),(l||!y)&&v.parentNode.removeChild(v),v=null},onDOMReady:function(){if(l=e.isHost,p=e.interval,d="#"+e.channel,h=0,y=e.useParent,w=g(e.remote),l){if(e.props={src:e.remote,name:j+e.channel+"_provider"},y)e.onLoad=function(){m=n,i(),c.up.callback(!0)};else{var t=0,r=e.delay/50;!function a(){if(++t>r)throw new Error("Unable to reference listenerwindow");try{m=v.contentWindow.frames[j+e.channel+"_consumer"]}catch(n){}m?(i(),c.up.callback(!0)):o(a,50)}()}v=_(e)}else m=n,i(),y?(v=parent,c.up.callback(!0)):(b(e,{props:{src:e.remote+"#"+e.channel+new Date,name:j+e.channel+"_consumer"},onLoad:function(){c.up.callback(!0)}}),v=_(e))},init:function(){f(c.onDOMReady,c)}}},D.stack.ReliableBehavior=function(n){var e,t,o=0,r=0,a="";return e={incoming:function(n,i){var c=n.indexOf("_"),s=n.substring(0,c).split(",");n=n.substring(c+1),s[0]==o&&(a="",t&&t(!0)),n.length>0&&(e.down.outgoing(s[1]+","+o+"_"+a,i),r!=s[1]&&(r=s[1],e.up.incoming(n,i)))},outgoing:function(n,i,c){a=n,t=c,e.down.outgoing(r+","+ ++o+"_"+n,i)}}},D.stack.QueueBehavior=function(n){function e(){if(n.remove&&0===i.length)return void S(t);if(!c&&0!==i.length&&!l){c=!0;var r=i.shift();t.down.outgoing(r.data,r.origin,function(n){c=!1,r.callback&&o(function(){r.callback(n)},0),e()})}}var t,i=[],c=!0,s="",l,u=0,f=!1,p=!1;return t={init:function(){w(n)&&(n={}),n.maxLength&&(u=n.maxLength,p=!0),n.lazy?f=!0:t.down.init()},callback:function(n){c=!1;var o=t.up;e(),o.callback(n)},incoming:function(e,o){if(p){var a=e.indexOf("_"),i=parseInt(e.substring(0,a),10);s+=e.substring(a+1),0===i&&(n.encode&&(s=r(s)),t.up.incoming(s,o),s="")}else t.up.incoming(e,o)},outgoing:function(o,r,c){n.encode&&(o=a(o));var s=[],l;if(p){for(;0!==o.length;)l=o.substring(0,u),o=o.substring(l.length),s.push(l);for(;l=s.shift();)i.push({data:s.length+"_"+l,origin:r,callback:0===s.length?c:null})}else i.push({data:o,origin:r,callback:c});f?t.down.init():e()},destroy:function(){l=!0,t.down.destroy()}}},D.stack.VerifyBehavior=function(n){function e(){o=Math.random().toString(16).substring(2),t.down.outgoing(o)}var t,o,r,a=!1;return t={incoming:function(a,i){var c=a.indexOf("_");-1===c?a===o?t.up.callback(!0):r||(r=a,n.initiate||e(),t.down.outgoing(a)):a.substring(0,c)===r&&t.up.incoming(a.substring(c+1),i)},outgoing:function(n,e,r){t.down.outgoing(o+"_"+n,e,r)},callback:function(t){n.initiate&&e()}}},D.stack.RpcBehavior=function(n,e){function t(n){n.jsonrpc="2.0",a.down.outgoing(i.stringify(n))}function o(n,e){var o=Array.prototype.slice;return function(){var r=arguments.length,a,i={method:e};r>0&&"function"==typeof arguments[r-1]?(r>1&&"function"==typeof arguments[r-2]?(a={success:arguments[r-2],error:arguments[r-1]},i.params=o.call(arguments,0,r-2)):(a={success:arguments[r-1]},i.params=o.call(arguments,0,r-1)),l[""+ ++c]=a,i.id=c):i.params=o.call(arguments,0),n.namedParams&&1===i.params.length&&(i.params=i.params[0]),t(i)}}function r(n,e,o,r){if(!o)return void(e&&t({id:e,error:{code:-32601,message:"Procedure not found."}}));var a,i;e?(a=function(n){a=F,t({id:e,result:n})},i=function(n,o){i=F;var r={id:e,error:{code:-32099,message:n}};o&&(r.error.data=o),t(r)}):a=i=F,s(r)||(r=[r]);try{var c=o.method.apply(o.scope,r.concat([a,i]));w(c)||a(c)}catch(l){i(l.message)}}var a,i=e.serializer||U(),c=0,l={};return a={incoming:function(n,o){var a=i.parse(n);if(a.method)e.handle?e.handle(a,t):r(a.method,a.id,e.local[a.method],a.params);else{var c=l[a.id];a.error?c.error&&c.error(a.error):c.success&&c.success(a.result),delete l[a.id]}},init:function(){if(e.remote)for(var t in e.remote)e.remote.hasOwnProperty(t)&&(n[t]=o(e.remote[t],t));a.down.init()},destroy:function(){for(var t in e.remote)e.remote.hasOwnProperty(t)&&n.hasOwnProperty(t)&&delete n[t];a.down.destroy()}}},R.easyXDM=D}(window,document,location,window.setTimeout,decodeURIComponent,encodeURIComponent);